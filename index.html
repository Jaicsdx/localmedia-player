<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Online Media Player</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg: #0b0f14;
      --panel: #0f151d;
      --muted: #8aa0b6;
      --text: #eaf2fb;
      --accent: #4ea1ff;
      --accent-2:#34d399;
      --danger:#ef4444;
      --warn:#f59e0b;
      --border: #1b2633;
      --shadow: 0 6px 24px rgba(0,0,0,.25);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, #0b0f14 0%, #0b0f14 60%, #0c1117 100%);
      color:var(--text);
    }

    /* App shell */
    .app{
      display:grid;
      grid-template-rows: auto 1fr;
      min-height:100%;
    }
    header{
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; gap:.75rem;
      padding:.75rem 1rem;
      background: rgba(10,14,19,.7);
      backdrop-filter:saturate(150%) blur(8px);
      border-bottom:1px solid var(--border);
    }
    .brand{
      display:flex; align-items:center; gap:.6rem; font-weight:700; letter-spacing:.2px;
    }
    .brand .dot{ width:.6rem; height:.6rem; border-radius:999px; background:var(--accent); box-shadow:0 0 18px rgba(78,161,255,.8)}
    .grow{flex:1}
    .ham{
      appearance:none; border:0; background:transparent; color:var(--text); cursor:pointer;
      display:grid; place-items:center; width:44px; height:44px; border-radius:10px;
    }
    .ham:hover{background:rgba(255,255,255,.06)}
    .ham svg{width:24px;height:24px}

    .layout{
      position:relative;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:1rem;
      padding:1rem;
    }

    /* Sidebar (features) */
    .sidebar{
      border:1px solid var(--border);
      background:linear-gradient(180deg,#0e141c,#0a1016);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:auto;
      max-height:calc(100dvh - 96px);
    }
    .side-head{
      display:flex; align-items:center; justify-content:space-between; gap:.75rem;
      padding:1rem 1rem .75rem 1rem; border-bottom:1px solid var(--border)
    }
    .side-head h2{margin:0; font-size:1rem; font-weight:700; letter-spacing:.2px}
    .side-body{padding:1rem; display:grid; gap:1rem}
    .section{
      padding:1rem; border:1px dashed var(--border); border-radius:12px; background:rgba(255,255,255,.02)
    }
    .section h3{margin:.2rem 0 .75rem 0; font-size:.95rem}
    .muted{color:var(--muted); font-size:.92rem}
    label{display:block; font-size:.88rem; margin:.35rem 0 .35rem .15rem; color:var(--muted)}
    input[type="text"], input[type="search"], input[type="file"], textarea, select{
      width:100%; padding:.75rem .85rem; background:#0d131a; color:var(--text);
      border:1px solid var(--border); border-radius:12px; outline:none;
    }
    input::placeholder, textarea::placeholder{color:#6f8297}
    textarea{resize:vertical; min-height:72px}
    .row{display:flex; gap:.6rem; align-items:center; flex-wrap:wrap}
    .btn{
      appearance:none; border:1px solid var(--border); background:#111821; color:var(--text);
      padding:.7rem 1rem; border-radius:12px; cursor:pointer; font-weight:600
    }
    .btn:hover{border-color:#27374a; background:#121c27}
    .btn.primary{background:linear-gradient(180deg,#1e90ff,#1779da); border-color:#1b6ecf}
    .btn.primary:hover{filter:saturate(1.05) brightness(1.02)}
    .btn.success{background:linear-gradient(180deg,#34d399,#10b981); border-color:#10b981}
    .btn.warn{background:linear-gradient(180deg,#f59e0b,#d97706); border-color:#d97706}
    .btn.danger{background:linear-gradient(180deg,#ef4444,#dc2626); border-color:#dc2626}
    .btn.ghost{background:transparent}
    .chip{display:inline-flex; align-items:center; gap:.4rem; padding:.3rem .6rem; border:1px solid var(--border); border-radius:999px; color:var(--muted); font-size:.82rem}

    /* Main area */
    .main{
      display:grid; grid-template-rows:auto auto 1fr; gap:1rem; min-width:0;
    }

    .tabs{ display:flex; gap:.5rem; flex-wrap:wrap}
    .tab{
      appearance:none; border:1px solid var(--border); background:#0e141c; color:var(--text);
      padding:.55rem .9rem; border-radius:999px; cursor:pointer; font-weight:600;
    }
    .tab.active{border-color:#2563eb; background:rgba(37,99,235,.15)}
    .searchbar{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap }
    .searchbar .grow{flex:1}

    .player{
      border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; background:#0a1016; box-shadow:var(--shadow)
    }
    .player .p-head{
      display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:.75rem 1rem; border-bottom:1px solid var(--border)
    }
    .player .p-body{padding:0; background:#000}
    video, iframe{width:100%; height:min(70dvh, 640px); display:block; background:#000}

    .gallery{
      display:grid; gap:.75rem;
      grid-template-columns: repeat( auto-fill, minmax(220px, 1fr) );
    }
    .card{
      background:linear-gradient(180deg,#0f151d,#0b1218);
      border:1px solid var(--border); border-radius:14px; overflow:hidden; min-width:0;
      display:flex; flex-direction:column;
    }
    .card h4{margin:.6rem .85rem .1rem .85rem; font-size:1rem; line-height:1.25}
    .card .meta{margin:0 .85rem .7rem .85rem; color:var(--muted); font-size:.86rem}
    .card .cta{display:flex; gap:.5rem; padding:.75rem; border-top:1px solid var(--border); background:#0b1016}
    .card .cta .btn{flex:1}

    /* Drawer behavior (mobile) */
    @media (max-width: 1024px){
      .layout{
        grid-template-columns: 1fr;
      }
      .sidebar{
        position: fixed; z-index:60; inset: 64px 0 0 auto; width: 92vw; max-width: 380px;
        transform: translateX(-8px) translateX(-100%);
        transition: transform .28s ease;
      }
      .app.sidebar-open .sidebar{
        transform: translateX(0);
      }
      .backdrop{
        position:fixed; z-index:55; inset:64px 0 0 0; background:rgba(0,0,0,.35); opacity:0; pointer-events:none; transition:opacity .2s ease;
      }
      .app.sidebar-open .backdrop{opacity:1; pointer-events:auto}
    }

    /* Helper */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .note{font-size:.9rem; color:var(--muted)}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#0a1016; border:1px solid var(--border); border-bottom-color:#1d2a3a; padding:.05rem .4rem; border-radius:6px}
  </style>
</head>
<body>
  <div id="app" class="app">
    <header>
      <button class="ham" id="toggleSidebar" aria-label="Toggle features (hamburger)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 6h18M3 12h18M3 18h18"/>
        </svg>
      </button>
      <div class="brand">
        <span class="dot" aria-hidden="true"></span>
        <span>Online Media Player</span>
      </div>
      <div class="grow"></div>
      <span class="chip" id="sourceChip" title="Where the library is loading from">Library: <strong style="margin-left:.35rem" id="librarySource">Loading…</strong></span>
    </header>

    <div class="layout">
      <!-- Features Sidebar (hidden/collapsible on mobile) -->
      <aside class="sidebar" id="sidebar" aria-label="Features panel">
        <div class="side-head">
          <h2>Controls & Library Tools</h2>
          <button class="btn ghost" id="closeSidebar" title="Close (Esc)">
            ✕
          </button>
        </div>
        <div class="side-body">
          <!-- Add / Edit movie -->
          <div class="section">
            <h3>Add movies (Name + OneDrive link) or play local files. JSON is still supported.</h3>
            <div class="row" style="margin-top:.5rem; gap:.8rem">
              <span class="chip">Cloud Library</span>
              <span class="chip">Local Files</span>
            </div>
            <div style="height:.4rem"></div>
            <label for="movieTitle">Movie Name</label>
            <input id="movieTitle" type="text" placeholder="e.g., Inception (2010)" autocomplete="off"/>

            <label for="movieLink" style="margin-top:.65rem">OneDrive Link or Embed Code</label>
            <textarea id="movieLink" placeholder="Paste OneDrive embed link or share URL"></textarea>

            <p class="muted" style="margin-top:.35rem">
              Tip: In OneDrive, open the video → <b>Embed</b> → copy the iframe or URL. This app auto-converts most OneDrive links.
            </p>

            <div class="row" style="margin-top:.6rem">
              <button id="addBtn" class="btn primary">Add Movie</button>
              <button id="saveBtn" class="btn success" style="display:none">Save Changes</button>
              <button id="cancelBtn" class="btn" style="display:none">Cancel</button>
            </div>
          </div>

          <!-- Search -->
          <div class="section">
            <h3>Search movies...</h3>
            <input id="searchBox" type="search" placeholder="Search movies..."/>
            <div class="row" style="margin-top:.5rem">
              <button id="clearSearch" class="btn">Clear</button>
            </div>
          </div>

          <!-- Data Management -->
          <div class="section">
            <h3>Data Management</h3>
            <div class="row">
              <button id="downloadJson" class="btn">Download movies.json</butt
